<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sitemap • Forecastler</title>
  <meta name="description" content="Human-friendly sitemap for Forecastler." />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.5; margin: 24px;}
    h1 {font-size: 1.8rem; margin-bottom: .25rem;}
    .muted {color:#555; font-size:.95rem; margin-bottom:1rem;}
    input[type="search"]{width:100%; max-width:520px; padding:.65rem .8rem; border:1px solid #ddd; border-radius:10px; margin:8px 0 16px}
    .grid{display:grid; gap:18px}
    section{border:1px solid #eee; border-radius:12px; padding:16px}
    section h2{font-size:1.2rem; margin:0 0 8px}
    ul{margin:0; padding-left:20px}
    li{margin:.25rem 0}
    .pill{display:inline-block; font-size:.8rem; border:1px solid #e5e7eb; padding:.1rem .5rem; border-radius:999px; margin-left:.5rem; color:#555}
    .header{display:flex; align-items:baseline; gap:12px; flex-wrap:wrap}
    .small{font-size:.85rem; color:#666}
    .spacer{height:2px}
    .counts{font-size:.9rem; color:#444; margin-top:6px}
    .footer{margin-top:28px; font-size:.9rem; color:#666}
    .button{display:inline-block; padding:.5rem .8rem; border:1px solid #ddd; border-radius:10px; text-decoration:none; cursor:pointer}
  </style>
</head>
<body>
  <div class="header">
    <h1>Forecastler Sitemap</h1>
    <span id="last-updated" class="pill">Last updated: —</span>
  </div>
  <p class="muted">Find any public page on Forecastler. Use the search box to filter links.</p>

  <label for="sitemap-search" class="small">Quick search</label>
  <input id="sitemap-search" type="search" placeholder="Type to filter… (e.g. privacy, faq, blog)" aria-label="Filter sitemap links" />

  <nav aria-label="Sitemap" class="grid" id="sitemap-sections">
    <!-- Sections will be rendered here -->
  </nav>

  <div class="footer">
    <span class="counts" id="counts"></span>
    <div class="spacer"></div>
    <button id="export-xml" class="button" type="button" aria-label="Export XML sitemap">Export XML (download)</button>
  </div>

<script>
const BASE = "https://forecastler.com";

const routes = [
  // Core
  { path: "/index.html",  title: "Home",      group: "Core",
    lastmod: "2025-08-14", changefreq: "weekly",  priority: 1.0 },
  { path: "/about.html",  title: "About Us",  group: "Core",
    lastmod: "2025-08-14", changefreq: "monthly", priority: 0.7 },
  { path: "/contact.html",title: "Contact",   group: "Core",
    lastmod: "2025-08-14", changefreq: "monthly", priority: 0.6 },
  { path: "/faq.html",    title: "FAQ",       group: "Core",
    lastmod: "2025-08-14", changefreq: "monthly", priority: 0.6 },

  // Legal
  { path: "/privacy.html",   title: "Privacy Policy", group: "Legal",
    lastmod: "2025-08-15", changefreq: "yearly",  priority: 0.8 },
  { path: "/terms.html",     title: "Terms of Use",   group: "Legal",
    lastmod: "2025-08-14", changefreq: "yearly",  priority: 0.8 },
  { path: "/disclaimer.html",title: "Disclaimer",     group: "Legal",
    lastmod: "2025-08-14", changefreq: "yearly",  priority: 0.6 },
  { path: "/cookies.html",   title: "Cookie Policy",  group: "Legal",
    lastmod: "2025-08-15", changefreq: "yearly",  priority: 0.6 },

  // Blog
  { path: "/blog.html",   title: "Blog",      group: "Blog",
    lastmod: "2025-08-14", changefreq: "weekly",  priority: 0.5 },

  // Meta
  { path: "/sitemap.html",title: "Sitemap",   group: "Core",
    lastmod: "2025-08-14", changefreq: "monthly", priority: 0.3 },
];

async function enrichWithLastModified() {
  const updates = await Promise.all(routes.map(async (r) => {
    try {
      const res = await fetch(r.path, { method: 'HEAD' });
      const lm = res.headers.get('Last-Modified');
      if (lm) r.lastmod = (new Date(lm)).toISOString().slice(0,10);
    } catch(e) {}
    return r;
  }));
  // Osveži badge posle ažuriranja
  const max = updates.reduce((m, r) => m > r.lastmod ? m : r.lastmod, "1970-01-01");
  document.getElementById("last-updated").textContent = `Last updated: ${max}`;
  renderSitemap(document.getElementById("sitemap-search").value || "");
}
enrichWithLastModified();

/** 2) Grupišite po sekcijama */
const groups = [
  { key: "Core",  title: "Main Pages" },
  { key: "Legal", title: "Legal" },
  { key: "Blog",  title: "Blog" },
];

/** 3) Render sekcija i linkova */
function renderSitemap(filter = "") {
  const root = document.getElementById("sitemap-sections");
  root.innerHTML = "";

  const norm = s => s.toLowerCase();
  const f = norm(filter);

  let total = 0;
  groups.forEach(g => {
    const items = routes
      .filter(r => r.group === g.key)
      .filter(r => !f || norm(r.title).includes(f) || norm(r.path).includes(f));

    if (!items.length) return;

    total += items.length;

    const sec = document.createElement("section");
    sec.innerHTML = `<h2>${g.title}</h2>`;
    const list = document.createElement("ul");

    items
      .sort((a,b) => a.title.localeCompare(b.title))
      .forEach(r => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = BASE + r.path;
        a.textContent = r.title;
        a.rel = "nofollow";
        a.referrerPolicy = "no-referrer";
        li.appendChild(a);

        const meta = document.createElement("span");
        meta.className = "pill";
        meta.textContent = `lastmod ${r.lastmod}`;
        li.appendChild(meta);

        list.appendChild(li);
      });

    sec.appendChild(list);
    root.appendChild(sec);
  });

  document.getElementById("counts").textContent = `Listed pages: ${total}`;
}

/** 4) Last updated badge = max lastmod iz routes */
(function setLastUpdated() {
  const max = routes.reduce((m, r) => m > r.lastmod ? m : r.lastmod, "1970-01-01");
  document.getElementById("last-updated").textContent = `Last updated: ${max}`;
})();

/** 5) Filtriranje */
document.getElementById("sitemap-search").addEventListener("input", (e) => {
  renderSitemap(e.target.value);
});

/** 6) Export XML (generiše sitemap.xml za preuzimanje) */
document.getElementById("export-xml").addEventListener("click", () => {
  const xmlns = 'xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml"';
  const xml = [
    `<?xml version="1.0" encoding="UTF-8"?>`,
    `<urlset ${xmlns}>`,
    ...routes.map(r => [
      `  <url>`,
      `    <loc>${BASE + r.path}</loc>`,
      `    <lastmod>${r.lastmod}</lastmod>`,
      `    <changefreq>${r.changefreq}</changefreq>`,
      `    <priority>${r.priority.toFixed(1)}</priority>`,
      `  </url>`
    ].join("\n")),
    `</urlset>`
  ].join("\n");

  const blob = new Blob([xml], {type: "application/xml"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "sitemap.xml";
  a.click();
  URL.revokeObjectURL(a.href);
});

renderSitemap();
</script>
</body>
</html>
